{
  "openapi": "3.0.2",
  "info": {
    "title": "ImpalaPay Switch REST API",
    "description": "Collect and disburse payments using the ImpalaPay switch API",
    "version": "0.1"
  },
  "servers": [{ "url": "https://staging.impalapay.net" }],
  "tags": [
    { "name": "authentication", "description": "Manage authentication tokens" },
    {
      "name": "collection",
      "description": "Manage collections"
    },
    { "name": "account", "description": "Query float and balances" }
  ],
  "components": {
    "parameters": {
      "transaction_id": {
        "name": "Transaction Reference",
        "in": "query",
        "schema": {
          "type": "string"
        },
        "example": "512145454527845"
      },
      "api_username": {
        "name": "Username",
        "in": "query",
        "schema": {
          "type": "string"
        },
        "description": "Username allocated during account creation",
        "example": "demo"
      },
      "session_id": {
        "name": "Session id",
        "schema": {
          "type": "string"
        },
        "in": "query",
        "description": "Username allocated during account creation",
        "example": "1f2ae476593b46799f87c802cfd72b54"
      },
      "command_status": {
        "name": "Command status",
        "schema": { "type": "string" },
        "in": "query",
        "example": "ok"
      },
      "currency_code": {
        "name": "currency code",
        "description": "Three character ISO 42172 currency code",
        "in": "query",
        "schema": {
          "type": "string"
        },
        "example": "KES"
      },
      "amount": {
        "name": "Amount of money",
        "description": "Floating point number with a maximum of 2 decimal places",
        "example": 40.78,
        "in": "query",
        "schema": {
          "type": "number",
          "format": "float"
        }
      },
      "mobile": {
        "name": "Mobile phone number",
        "description": "Mobile number including country prefix",
        "in": "query",
        "example": "254715290374",
        "schema": {
          "type": "string"
        }
      },
      "country_code": {
        "name": "Country code",
        "description": "2 digit ISO 31662 country code",
        "example": "KE",
        "in": "query",
        "schema": {
          "type": "string"
        }
      },
      "client_datetime": {
        "name": "Client date and time",
        "description": "ISO 86013 date string representing the time the client initiated the request",
        "example": "2021-07-25T15:54:45+02:00",
        "in": "query",
        "schema": {
          "type": "string",
          "format": "date-time"
        }
      },
      "status_code": {
        "name": "Status code",
        "schema": {
          "type": "string"
        },
        "description": "Valid switch's status code. Refer to system status codes",
        "example": "S001",
        "in": "query"
      },
      "remit_status": {
        "name": "Remit status",
        "schema": {
          "type": "string"
        },
        "description": "Valid switch's remit status string.",
        "in": "query",
        "example": "CREDIT_IN_PROGRESS"
      },
      "client_reference": {
        "name": "Client's transaction reference",
        "schema": {
          "type": "string"
        },
        "in": "query",
        "description": "Unique reference generated by the consuming/client application",
        "example": "OPIEIONUI02392"
      }
    },
    "schemas": {
      "AuthQuery": {
        "type": "object",
        "properties": {
          "api_username": {
            "$ref": "#/components/parameters/api_username"
          },
          "api_password": {
            "type": "string",
            "description": "Password associated with the username",
            "example": "password",
            "format": "password"
          }
        }
      },
      "AuthSuccess": {
        "type": "object",
        "properties": {
          "api_username": {
            "$ref": "#/components/parameters/api_username"
          },
          "session_id": {
            "$ref": "#/components/parameters/session_id"
          },
          "status": {
            "$ref": "#/components/parameters/command_status"
          }
        }
      },
      "GenericQuery": {
        "type": "object",
        "properties": {
          "api_username": {
            "$ref": "#/components/parameters/api_username"
          },
          "session_id": {
            "$ref": "#/components/parameters/session_id"
          }
        }
      },
      "NetworkQuerySuccess": {
        "type": "object",
        "properties": {
          "api_username": {
            "$ref": "#/components/parameters/api_username"
          },
          "command_status": {
            "$ref": "#/components/parameters/command_status"
          },
          "Collection_Networks": {
            "type": "array",
            "items": {},
            "description": "The data property is returned when there is a user data/information that is needed to use in updating the client or user interface.",
            "example": [
              {
                "CollectionName": "SAFARICOMKENYA",
                "CollectionType": "PAYBILL",
                "SupportDirectDebit": true,
                "Country": "Kenya",
                "Instructions": "The application will direct You on how to load your Money through this Direct debit Option."
              }
            ]
          }
        }
      },
      "DirectDebitCommand": {
        "type": "object",
        "properties": {
          "api_username": {
            "$ref": "#/components/parameters/api_username"
          },
          "debitor_currency_code": {
            "$ref": "#/components/parameters/currency_code"
          },
          "amount": {
            "$ref": "#/components/parameters/amount"
          },
          "debitor_mobile": {
            "$ref": "#/components/parameters/mobile"
          },
          "route_name": {
            "type": "string",
            "example": "SAFARICOMKENYA",
            "description": "Debitor's network. Obtain the route name from a /fetchnetworks query"
          },
          "client_datetime": {
            "$ref": "#/components/parameters/client_datetime"
          },
          "session_id": {
            "type": "string",
            "$ref": "#/components/parameters/session_id"
          },
          "debitor_name": {
            "type": "string",
            "description": "Debitor's full name"
          },
          "debitor_account": {
            "$ref": "#/components/parameters/mobile",
            "description": "Debitor's account with the network. I most cases it's the mobile phone number"
          },
          "debitor_country_code": {
            "$ref": "#/components/parameters/country_code"
          },
          "reference_number": {
            "$ref": "#/components/parameters/client_reference"
          }
        }
      },
      "DirectDebitSuccess": {
        "type": "object",
        "properties": {
          "api_username": {
            "$ref": "#/components/parameters/api_username"
          },
          "transaction_id": {
            "$ref": "#/components/parameters/transaction_id"
          },
          "command_status": {
            "$ref": "#/components/parameters/command_status"
          },
          "status_code": {
            "$ref": "#/components/parameters/status_code"
          },
          "remit_status": {
            "$ref": "#/components/parameters/remit_status"
          }
        }
      },
      "CollectionStatusQuery": {
        "type": "object",
        "properties": {
          "api_username": {
            "$ref": "#/components/parameters/api_username"
          },
          "reference_number": {
            "$ref": "#/components/parameters/client_reference"
          }
        }
      },
      "CollectionStatusSuccess": {
        "type": "object",
        "properties": {
          "api_username": {
            "$ref": "#/components/parameters/api_username"
          },
          "transaction_id": {
            "$ref": "#/components/parameters/transaction_id"
          },
          "transaction_amount": {
            "$ref": "#/components/parameters/transaction_id",
            "description": "Amount that was debited for this transaction"
          },
          "sender_name": {
            "type": "string",
            "description": "Name of debited account's owner"
          },
          "transaction_status": {
            "$ref": "#/components/parameters/status_code"
          },
          "command_status": {
            "$ref": "#/components/parameters/command_status"
          }
        }
      },
      "BalanceSuccess": {
        "type": "object",
        "properties": {
          "api_username": {
            "$ref": "#/components/parameters/api_username"
          },
          "float": {
            "$ref": "#/components/parameters/amount",
            "description": "Client's float (USD) held in an escrow account"
          },
          "balance": {
            "description": "Client balance per country encoded in a string",
            "example": "BF-234, GA-890, RW-390, UG-0, ZM-0"
          },
          "status": {
            "$ref": "#/components/parameters/command_status"
          }
        }
      }
    }
  },
  "paths": {
    "/fetchnetworks": {
      "post": {
        "tags": ["collection"],
        "summary": "Lists integrated collection networks",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/GenericQuery"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "List of integrated networks",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/NetworkQuerySuccess"
                }
              }
            }
          }
        }
      }
    },
    "/directdebit": {
      "post": {
        "tags": ["collection"],
        "description": "Prompt a charge request in the debitors mobile (STK/USSD push)",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/DirectDebitCommand"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "The charge request was sent to the subscriber",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DirectDebitSuccess"
                }
              }
            }
          }
        }
      }
    },
    "/collectionrefNumStatus": {
      "post": {
        "tags": ["collection"],
        "description": "Check the status of a transaction",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CollectionStatusQuery"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Transaction was retrieved",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/CollectionStatusSuccess"
                }
              }
            }
          }
        }
      }
    },
    "/specialsessionid": {
      "post": {
        "tags": ["authentication"],
        "description": "Authenticate client and acquire a session id (authentication token)",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AuthQuery"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Authenticated",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AuthSuccess"
                }
              }
            }
          }
        }
      }
    },
    "/balance": {
      "post": {
        "tags": ["account"],
        "description": "Query float and balance",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/GenericQuery" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Balances retrieved",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/BalanceSuccess"
                }
              }
            }
          }
        }
      }
    }
  }
}
